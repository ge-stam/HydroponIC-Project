\hypertarget{_edgent___e_s_p32_2_blynk_edgent_8h_source}{}\doxysection{Blynk\+Edgent.\+h}
\label{_edgent___e_s_p32_2_blynk_edgent_8h_source}\index{lib/Blynk/examples/Blynk.Edgent/Edgent\_ESP32/BlynkEdgent.h@{lib/Blynk/examples/Blynk.Edgent/Edgent\_ESP32/BlynkEdgent.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{2 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{3   \textcolor{keywordtype}{void} app\_loop();}
\DoxyCodeLine{4   \textcolor{keywordtype}{void} eraseMcuConfig();}
\DoxyCodeLine{5   \textcolor{keywordtype}{void} restartMCU();}
\DoxyCodeLine{6 \}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include "{}Settings.h"{}}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{_blynk_simple_esp32___s_s_l_8h}{BlynkSimpleEsp32\_SSL.h}}>}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#ifndef BLYNK\_NEW\_LIBRARY}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#error "{}Old version of Blynk library is in use. Please replace it with the new one."{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#if !defined(BLYNK\_TEMPLATE\_ID) || !defined(BLYNK\_DEVICE\_NAME)}}
\DoxyCodeLine{16 \textcolor{preprocessor}{\#error "{}Please specify your BLYNK\_TEMPLATE\_ID and BLYNK\_DEVICE\_NAME"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include "{}BlynkState.h"{}}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include "{}ConfigStore.h"{}}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}ResetButton.h"{}}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include "{}ConfigMode.h"{}}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include "{}Indicator.h"{}}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}OTA.h"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}Console.h"{}}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{inline}}
\DoxyCodeLine{28 \textcolor{keywordtype}{void} BlynkState::set(State m) \{}
\DoxyCodeLine{29   \textcolor{keywordflow}{if} (state != m \&\& m < MODE\_MAX\_VALUE) \{}
\DoxyCodeLine{30     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(StateStr[state]) + \textcolor{stringliteral}{"{} => "{}} + StateStr[m]);}
\DoxyCodeLine{31     state = m;}
\DoxyCodeLine{32 }
\DoxyCodeLine{33     \textcolor{comment}{// You can put your state handling here,}}
\DoxyCodeLine{34     \textcolor{comment}{// i.e. implement custom indication}}
\DoxyCodeLine{35   \}}
\DoxyCodeLine{36 \}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{keywordtype}{void} printDeviceBanner()}
\DoxyCodeLine{39 \{}
\DoxyCodeLine{40   Blynk.printBanner();}
\DoxyCodeLine{41   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}});}
\DoxyCodeLine{42   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Product:  "{}}) + BLYNK\_DEVICE\_NAME);}
\DoxyCodeLine{43   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Firmware: "{}}) + BLYNK\_FIRMWARE\_VERSION \textcolor{stringliteral}{"{} (build "{}} \_\_DATE\_\_ \textcolor{stringliteral}{"{} "{}} \_\_TIME\_\_ \textcolor{stringliteral}{"{})"{}});}
\DoxyCodeLine{44   \textcolor{keywordflow}{if} (configStore.getFlag(CONFIG\_FLAG\_VALID)) \{}
\DoxyCodeLine{45     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Token:    ..."{}}) + (configStore.cloudToken+28));}
\DoxyCodeLine{46   \}}
\DoxyCodeLine{47   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Device:   "{}}) + BLYNK\_INFO\_DEVICE + \textcolor{stringliteral}{"{} @ "{}} + ESP.getCpuFreqMHz() + \textcolor{stringliteral}{"{}MHz"{}});}
\DoxyCodeLine{48   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}MAC:      "{}}) + WiFi.macAddress());}
\DoxyCodeLine{49   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Flash:    "{}}) + ESP.getFlashChipSize() / 1024 + \textcolor{stringliteral}{"{}K"{}});}
\DoxyCodeLine{50   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}ESP sdk:  "{}}) + ESP.getSdkVersion());}
\DoxyCodeLine{51   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Chip rev: "{}}) + ESP.getChipRevision());}
\DoxyCodeLine{52   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Free mem: "{}}) + ESP.getFreeHeap());}
\DoxyCodeLine{53   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/"{}});}
\DoxyCodeLine{54 \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56 \textcolor{keywordtype}{void} runBlynkWithChecks() \{}
\DoxyCodeLine{57   Blynk.run();}
\DoxyCodeLine{58   \textcolor{keywordflow}{if} (BlynkState::get() == MODE\_RUNNING) \{}
\DoxyCodeLine{59     \textcolor{keywordflow}{if} (!Blynk.connected()) \{}
\DoxyCodeLine{60       \textcolor{keywordflow}{if} (WiFi.status() == WL\_CONNECTED) \{}
\DoxyCodeLine{61         BlynkState::set(MODE\_CONNECTING\_CLOUD);}
\DoxyCodeLine{62       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{63         BlynkState::set(MODE\_CONNECTING\_NET);}
\DoxyCodeLine{64       \}}
\DoxyCodeLine{65     \}}
\DoxyCodeLine{66   \}}
\DoxyCodeLine{67 \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{keyword}{class }\mbox{\hyperlink{class_edgent}{Edgent}} \{}
\DoxyCodeLine{70 }
\DoxyCodeLine{71 \textcolor{keyword}{public}:}
\DoxyCodeLine{72   \textcolor{keywordtype}{void} begin()}
\DoxyCodeLine{73   \{}
\DoxyCodeLine{74     WiFi.persistent(\textcolor{keyword}{false});}
\DoxyCodeLine{75     WiFi.enableSTA(\textcolor{keyword}{true}); \textcolor{comment}{// Needed to get MAC}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     indicator\_init();}
\DoxyCodeLine{78     button\_init();}
\DoxyCodeLine{79     config\_init();}
\DoxyCodeLine{80     console\_init();}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     printDeviceBanner();}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \textcolor{keywordflow}{if} (configStore.getFlag(CONFIG\_FLAG\_VALID)) \{}
\DoxyCodeLine{85       BlynkState::set(MODE\_CONNECTING\_NET);}
\DoxyCodeLine{86     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (config\_load\_blnkopt()) \{}
\DoxyCodeLine{87       \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Firmware is preprovisioned"{}});}
\DoxyCodeLine{88       BlynkState::set(MODE\_CONNECTING\_NET);}
\DoxyCodeLine{89     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{90       BlynkState::set(MODE\_WAIT\_CONFIG);}
\DoxyCodeLine{91     \}}
\DoxyCodeLine{92   \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{keywordtype}{void} run() \{}
\DoxyCodeLine{95     app\_loop();}
\DoxyCodeLine{96     \textcolor{keywordflow}{switch} (BlynkState::get()) \{}
\DoxyCodeLine{97     \textcolor{keywordflow}{case} MODE\_WAIT\_CONFIG:       }
\DoxyCodeLine{98     \textcolor{keywordflow}{case} MODE\_CONFIGURING:       enterConfigMode();    \textcolor{keywordflow}{break};}
\DoxyCodeLine{99     \textcolor{keywordflow}{case} MODE\_CONNECTING\_NET:    enterConnectNet();    \textcolor{keywordflow}{break};}
\DoxyCodeLine{100     \textcolor{keywordflow}{case} MODE\_CONNECTING\_CLOUD:  enterConnectCloud();  \textcolor{keywordflow}{break};}
\DoxyCodeLine{101     \textcolor{keywordflow}{case} MODE\_RUNNING:           runBlynkWithChecks(); \textcolor{keywordflow}{break};}
\DoxyCodeLine{102     \textcolor{keywordflow}{case} MODE\_OTA\_UPGRADE:       enterOTA();           \textcolor{keywordflow}{break};}
\DoxyCodeLine{103     \textcolor{keywordflow}{case} MODE\_SWITCH\_TO\_STA:     enterSwitchToSTA();   \textcolor{keywordflow}{break};}
\DoxyCodeLine{104     \textcolor{keywordflow}{case} MODE\_RESET\_CONFIG:      enterResetConfig();   \textcolor{keywordflow}{break};}
\DoxyCodeLine{105     \textcolor{keywordflow}{default}:                     enterError();         \textcolor{keywordflow}{break};}
\DoxyCodeLine{106     \}}
\DoxyCodeLine{107   \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111 \mbox{\hyperlink{class_edgent}{Edgent}} BlynkEdgent;}
\DoxyCodeLine{112 BlynkTimer edgentTimer;}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{keywordtype}{void} app\_loop() \{}
\DoxyCodeLine{115     edgentTimer.run();}
\DoxyCodeLine{116     edgentConsole.run();}
\DoxyCodeLine{117 \}}
\DoxyCodeLine{118 }

\end{DoxyCode}
