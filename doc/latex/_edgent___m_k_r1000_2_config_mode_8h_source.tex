\hypertarget{_edgent___m_k_r1000_2_config_mode_8h_source}{}\doxysection{Config\+Mode.\+h}
\label{_edgent___m_k_r1000_2_config_mode_8h_source}\index{lib/Blynk/examples/Blynk.Edgent/Edgent\_MKR1000/ConfigMode.h@{lib/Blynk/examples/Blynk.Edgent/Edgent\_MKR1000/ConfigMode.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{2 \textcolor{preprocessor}{\#include <WiFiClient.h>}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include <WiFiMDNSResponder.h>}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <utility>}}
\DoxyCodeLine{5 }
\DoxyCodeLine{6 WiFiServer server(80);}
\DoxyCodeLine{7 WiFiMDNSResponder mdnsResponder;}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 String urlDecode(\textcolor{keyword}{const} String\& text);}
\DoxyCodeLine{10 String urlFindArg(\textcolor{keyword}{const} String\& url, \textcolor{keyword}{const} String\& arg);}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{enum} Request \{}
\DoxyCodeLine{13   REQ\_BOARD\_INFO,}
\DoxyCodeLine{14   REQ\_ROOT,}
\DoxyCodeLine{15   REQ\_SCAN\_WIFI,}
\DoxyCodeLine{16   REQ\_CONFIG,}
\DoxyCodeLine{17   REQ\_RESET,}
\DoxyCodeLine{18   REQ\_REBOOT}
\DoxyCodeLine{19 \};}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 \textcolor{keyword}{const} \textcolor{keywordtype}{char}* config\_form = R\textcolor{stringliteral}{"{}html(}}
\DoxyCodeLine{22 \textcolor{stringliteral}{<!DOCTYPE HTML>}}
\DoxyCodeLine{23 \textcolor{stringliteral}{<html>}}
\DoxyCodeLine{24 \textcolor{stringliteral}{<head>}}
\DoxyCodeLine{25 \textcolor{stringliteral}{  <title>WiFi setup</title>}}
\DoxyCodeLine{26 \textcolor{stringliteral}{  <style>}}
\DoxyCodeLine{27 \textcolor{stringliteral}{  body \{}}
\DoxyCodeLine{28 \textcolor{stringliteral}{    background-\/color: \#fcfcfc;}}
\DoxyCodeLine{29 \textcolor{stringliteral}{    box-\/sizing: border-\/box;}}
\DoxyCodeLine{30 \textcolor{stringliteral}{  \}}}
\DoxyCodeLine{31 \textcolor{stringliteral}{  body, input \{}}
\DoxyCodeLine{32 \textcolor{stringliteral}{    font-\/family: Roboto, sans-\/serif;}}
\DoxyCodeLine{33 \textcolor{stringliteral}{    font-\/weight: 400;}}
\DoxyCodeLine{34 \textcolor{stringliteral}{    font-\/size: 16px;}}
\DoxyCodeLine{35 \textcolor{stringliteral}{  \}}}
\DoxyCodeLine{36 \textcolor{stringliteral}{  .centered \{}}
\DoxyCodeLine{37 \textcolor{stringliteral}{    position: fixed;}}
\DoxyCodeLine{38 \textcolor{stringliteral}{    top: 50\%;}}
\DoxyCodeLine{39 \textcolor{stringliteral}{    left: 50\%;}}
\DoxyCodeLine{40 \textcolor{stringliteral}{    transform: translate(-\/50\%, -\/50\%);}}
\DoxyCodeLine{41 \textcolor{stringliteral}{}}
\DoxyCodeLine{42 \textcolor{stringliteral}{    padding: 20px;}}
\DoxyCodeLine{43 \textcolor{stringliteral}{    background-\/color: \#ccc;}}
\DoxyCodeLine{44 \textcolor{stringliteral}{    border-\/radius: 4px;}}
\DoxyCodeLine{45 \textcolor{stringliteral}{  \}}}
\DoxyCodeLine{46 \textcolor{stringliteral}{  td \{ padding:0 0 0 5px; \}}}
\DoxyCodeLine{47 \textcolor{stringliteral}{  label \{ white-\/space:nowrap; \}}}
\DoxyCodeLine{48 \textcolor{stringliteral}{  input \{ width: 20em; \}}}
\DoxyCodeLine{49 \textcolor{stringliteral}{  input[name="{}port"{}] \{ width: 5em; \}}}
\DoxyCodeLine{50 \textcolor{stringliteral}{  input[type="{}submit"{}], img \{ margin: auto; display: block; width: 30\%; \}}}
\DoxyCodeLine{51 \textcolor{stringliteral}{  </style>}}
\DoxyCodeLine{52 \textcolor{stringliteral}{</head> }}
\DoxyCodeLine{53 \textcolor{stringliteral}{<body>}}
\DoxyCodeLine{54 \textcolor{stringliteral}{<div class="{}centered"{}>}}
\DoxyCodeLine{55 \textcolor{stringliteral}{  <form method="{}get"{} action="{}config"{}>}}
\DoxyCodeLine{56 \textcolor{stringliteral}{    <table>}}
\DoxyCodeLine{57 \textcolor{stringliteral}{    <tr><td><label for="{}ssid"{}>WiFi SSID:</label></td>  <td><input type="{}text"{} name="{}ssid"{} length=64 required="{}required"{}></td></tr>}}
\DoxyCodeLine{58 \textcolor{stringliteral}{    <tr><td><label for="{}pass"{}>Password:</label></td>   <td><input type="{}text"{} name="{}pass"{} length=64></td></tr>}}
\DoxyCodeLine{59 \textcolor{stringliteral}{    <tr><td><label for="{}blynk"{}>Auth token:</label></td><td><input type="{}text"{} name="{}blynk"{} placeholder="{}a0b1c2d..."{} pattern="{}[-\/\_a-\/zA-\/Z0-\/9]\{32\}"{} maxlength="{}32"{} required="{}required"{}></td></tr>}}
\DoxyCodeLine{60 \textcolor{stringliteral}{    <tr><td><label for="{}host"{}>Host:</label></td>       <td><input type="{}text"{} name="{}host"{} value="{}blynk.cloud"{} length=64></td></tr>}}
\DoxyCodeLine{61 \textcolor{stringliteral}{    <tr><td><label for="{}port\_ssl"{}>Port:</label></td>   <td><input type="{}number"{} name="{}port\_ssl"{} value="{}443"{} min="{}1"{} max="{}65535"{}></td></tr>}}
\DoxyCodeLine{62 \textcolor{stringliteral}{    </table><br/>}}
\DoxyCodeLine{63 \textcolor{stringliteral}{    <input type="{}submit"{} value="{}Apply"{}>}}
\DoxyCodeLine{64 \textcolor{stringliteral}{  </form>}}
\DoxyCodeLine{65 \textcolor{stringliteral}{</div>}}
\DoxyCodeLine{66 \textcolor{stringliteral}{</body>}}
\DoxyCodeLine{67 \textcolor{stringliteral}{</html>}}
\DoxyCodeLine{68 \textcolor{stringliteral}{)html"{};}}
\DoxyCodeLine{69 \textcolor{stringliteral}{}}
\DoxyCodeLine{70 \textcolor{stringliteral}{}\textcolor{keywordtype}{void} restartMCU() \{}
\DoxyCodeLine{71   NVIC\_SystemReset();}
\DoxyCodeLine{72 \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{keywordtype}{void} getWiFiName(\textcolor{keywordtype}{char}* buff, \textcolor{keywordtype}{size\_t} len, \textcolor{keywordtype}{bool} withPrefix = \textcolor{keyword}{true}) \{}
\DoxyCodeLine{76   \textcolor{keyword}{static} \textcolor{keywordtype}{byte} mac[6] = \{ 0, \};}
\DoxyCodeLine{77   \textcolor{keyword}{static} \textcolor{keywordtype}{bool} needMac = \textcolor{keyword}{true};}
\DoxyCodeLine{78   \textcolor{keywordflow}{if} (needMac) \{}
\DoxyCodeLine{79     WiFi.macAddress(mac);}
\DoxyCodeLine{80     needMac = \textcolor{keyword}{false};}
\DoxyCodeLine{81   \}}
\DoxyCodeLine{82 }
\DoxyCodeLine{83   uint32\_t unique = 0;}
\DoxyCodeLine{84   \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i=0; i<4; i++) \{}
\DoxyCodeLine{85     unique = BlynkCRC32(\&mac, \textcolor{keyword}{sizeof}(mac), unique);}
\DoxyCodeLine{86   \}}
\DoxyCodeLine{87   unique \&= 0xFFFFF;}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   \textcolor{keywordflow}{if} (withPrefix) \{}
\DoxyCodeLine{90     snprintf(buff, len, \textcolor{stringliteral}{"{}Blynk \%s-\/\%05X"{}}, BLYNK\_DEVICE\_NAME, unique);}
\DoxyCodeLine{91   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{92     snprintf(buff, len, \textcolor{stringliteral}{"{}\%s-\/\%05X"{}}, BLYNK\_DEVICE\_NAME, unique);}
\DoxyCodeLine{93   \}}
\DoxyCodeLine{94 \}}
\DoxyCodeLine{95 }
\DoxyCodeLine{96 String urlDecode(\textcolor{keyword}{const} String\& text)}
\DoxyCodeLine{97 \{}
\DoxyCodeLine{98   String decoded = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{99   \textcolor{keywordtype}{char} temp[] = \textcolor{stringliteral}{"{}0x00"{}};}
\DoxyCodeLine{100   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} len = text.length();}
\DoxyCodeLine{101   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0;}
\DoxyCodeLine{102   \textcolor{keywordflow}{while} (i < len) \{}
\DoxyCodeLine{103     \textcolor{keywordtype}{char} decodedChar;}
\DoxyCodeLine{104     \textcolor{keywordtype}{char} encodedChar = text.charAt(i++);}
\DoxyCodeLine{105     \textcolor{keywordflow}{if} ((encodedChar == \textcolor{charliteral}{'\%'}) \&\& (i + 1 < len)) \{}
\DoxyCodeLine{106       temp[2] = text.charAt(i++);}
\DoxyCodeLine{107       temp[3] = text.charAt(i++);}
\DoxyCodeLine{108 }
\DoxyCodeLine{109       decodedChar = strtol(temp, NULL, 16);}
\DoxyCodeLine{110     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{111       \textcolor{keywordflow}{if} (encodedChar == \textcolor{charliteral}{'+'}) \{}
\DoxyCodeLine{112         decodedChar = \textcolor{charliteral}{' '};}
\DoxyCodeLine{113       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{114         decodedChar = encodedChar;}
\DoxyCodeLine{115       \}}
\DoxyCodeLine{116     \}}
\DoxyCodeLine{117     decoded += decodedChar;}
\DoxyCodeLine{118   \}}
\DoxyCodeLine{119   \textcolor{keywordflow}{return} decoded;}
\DoxyCodeLine{120 \}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122 String urlFindArg(\textcolor{keyword}{const} String\& url, \textcolor{keyword}{const} String\& arg)}
\DoxyCodeLine{123 \{}
\DoxyCodeLine{124   \textcolor{keywordtype}{int} s = url.indexOf(\textcolor{stringliteral}{"{}\&"{}} + arg + \textcolor{stringliteral}{"{}="{}});}
\DoxyCodeLine{125   \textcolor{keywordflow}{if} (s < 0)}
\DoxyCodeLine{126     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{127   \textcolor{keywordtype}{int} s\_len = arg.length() + 2;}
\DoxyCodeLine{128   \textcolor{keywordtype}{int} e = url.indexOf(\textcolor{charliteral}{'\&'}, s + s\_len);}
\DoxyCodeLine{129   \textcolor{keywordflow}{return} urlDecode(url.substring(s + s\_len, e));}
\DoxyCodeLine{130 \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132 String scanNetworks()}
\DoxyCodeLine{133 \{}
\DoxyCodeLine{134     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Scanning networks..."{}});}
\DoxyCodeLine{135     \textcolor{keywordtype}{int} wifi\_nets = WiFi.scanNetworks();}
\DoxyCodeLine{136     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Found networks: "{}}) + wifi\_nets);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138     \textcolor{keywordflow}{if} (wifi\_nets > 0) \{}
\DoxyCodeLine{139       \textcolor{comment}{// Sort networks}}
\DoxyCodeLine{140       \textcolor{keywordtype}{int} indices[wifi\_nets];}
\DoxyCodeLine{141       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < wifi\_nets; i++) \{}
\DoxyCodeLine{142         indices[i] = i;}
\DoxyCodeLine{143       \}}
\DoxyCodeLine{144       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < wifi\_nets; i++) \{}
\DoxyCodeLine{145         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = i + 1; j < wifi\_nets; j++) \{}
\DoxyCodeLine{146           \textcolor{keywordflow}{if} (WiFi.RSSI(indices[j]) > WiFi.RSSI(indices[i])) \{}
\DoxyCodeLine{147             std::swap(indices[i], indices[j]);}
\DoxyCodeLine{148           \}}
\DoxyCodeLine{149         \}}
\DoxyCodeLine{150       \}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152       wifi\_nets = BlynkMin(15, wifi\_nets); \textcolor{comment}{// Show top 15 networks}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154       \textcolor{comment}{// TODO: skip empty names}}
\DoxyCodeLine{155       String result = \textcolor{stringliteral}{"{}[\(\backslash\)n"{}};}
\DoxyCodeLine{156 }
\DoxyCodeLine{157       \textcolor{keywordtype}{char} buff[256];}
\DoxyCodeLine{158       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < wifi\_nets; i++)\{}
\DoxyCodeLine{159         \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = indices[i];}
\DoxyCodeLine{160 }
\DoxyCodeLine{161         \textcolor{keyword}{const} \textcolor{keywordtype}{char}* sec;}
\DoxyCodeLine{162         \textcolor{keywordflow}{switch} (WiFi.encryptionType(\textcolor{keywordtype}{id})) \{}
\DoxyCodeLine{163         \textcolor{keywordflow}{case} ENC\_TYPE\_WEP:           sec = \textcolor{stringliteral}{"{}WEP"{}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{164         \textcolor{keywordflow}{case} ENC\_TYPE\_TKIP:          sec = \textcolor{stringliteral}{"{}WPA/WPA2"{}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{165         \textcolor{keywordflow}{case} ENC\_TYPE\_CCMP:          sec = \textcolor{stringliteral}{"{}WPA/WPA2"{}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{166         \textcolor{keywordflow}{case} ENC\_TYPE\_NONE:          sec = \textcolor{stringliteral}{"{}OPEN"{}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{167         \textcolor{keywordflow}{default}:                     sec = \textcolor{stringliteral}{"{}unknown"{}}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{168         \}}
\DoxyCodeLine{169 }
\DoxyCodeLine{170         \textcolor{keywordtype}{byte} mac[6] = \{ 0, \};}
\DoxyCodeLine{171         WiFi.BSSID(\textcolor{keywordtype}{id}, mac);}
\DoxyCodeLine{172 }
\DoxyCodeLine{173         snprintf(buff, \textcolor{keyword}{sizeof}(buff),}
\DoxyCodeLine{174           R\textcolor{stringliteral}{"{}json(  \{"{}ssid"{}:"{}\%s"{},"{}bssid"{}:"{}\%02x:\%02x:\%02x:\%02x:\%02x:\%02x"{},"{}rssi"{}:\%i,"{}sec"{}:"{}\%s"{},"{}ch"{}:\%i\})json"{},}}
\DoxyCodeLine{175 \textcolor{stringliteral}{          WiFi.SSID(}\textcolor{keywordtype}{id}),}
\DoxyCodeLine{176           mac[5], mac[4], mac[3], mac[2], mac[1], mac[0],}
\DoxyCodeLine{177           WiFi.RSSI(\textcolor{keywordtype}{id}),}
\DoxyCodeLine{178           sec,}
\DoxyCodeLine{179           WiFi.channel(\textcolor{keywordtype}{id})}
\DoxyCodeLine{180         );}
\DoxyCodeLine{181 }
\DoxyCodeLine{182         result += buff;}
\DoxyCodeLine{183         \textcolor{keywordflow}{if} (i != wifi\_nets-\/1) result += \textcolor{stringliteral}{"{},\(\backslash\)n"{}};}
\DoxyCodeLine{184       \}}
\DoxyCodeLine{185       \textcolor{keywordflow}{return} result + \textcolor{stringliteral}{"{}\(\backslash\)n]"{}};}
\DoxyCodeLine{186     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{187       \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}[]"{}};}
\DoxyCodeLine{188     \}}
\DoxyCodeLine{189 \}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191 \textcolor{keywordtype}{void} enterConfigMode()}
\DoxyCodeLine{192 \{}
\DoxyCodeLine{193   \textcolor{keywordtype}{char} ssidBuff[64];}
\DoxyCodeLine{194   getWiFiName(ssidBuff, \textcolor{keyword}{sizeof}(ssidBuff));}
\DoxyCodeLine{195 }
\DoxyCodeLine{196   String networks = scanNetworks();}
\DoxyCodeLine{197 }
\DoxyCodeLine{198   WiFi.end();}
\DoxyCodeLine{199   WiFi.config(WIFI\_AP\_IP);}
\DoxyCodeLine{200   WiFi.beginAP(ssidBuff);}
\DoxyCodeLine{201   mdnsResponder.begin(CONFIG\_AP\_URL);}
\DoxyCodeLine{202 }
\DoxyCodeLine{203   delay(500);}
\DoxyCodeLine{204   IPAddress myIP = WiFi.localIP();}
\DoxyCodeLine{205   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}AP SSID: "{}}) + ssidBuff);}
\DoxyCodeLine{206   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}AP IP:   "{}}) + myIP[0] + \textcolor{stringliteral}{"{}."{}} + myIP[1] + \textcolor{stringliteral}{"{}."{}} + myIP[2] + \textcolor{stringliteral}{"{}."{}} + myIP[3]);}
\DoxyCodeLine{207   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}AP URL:  "{}}) + CONFIG\_AP\_URL + \textcolor{stringliteral}{"{}.local"{}});}
\DoxyCodeLine{208 }
\DoxyCodeLine{209   \textcolor{keywordtype}{int} status = WiFi.status();}
\DoxyCodeLine{210 }
\DoxyCodeLine{211   \textcolor{keywordflow}{while}(BlynkState::is(MODE\_WAIT\_CONFIG)) \{}
\DoxyCodeLine{212     \textcolor{comment}{// Workaround for https://github.com/arduino-\/libraries/WiFi101/issues/46}}
\DoxyCodeLine{213     \textcolor{keywordflow}{if} (status != WiFi.status()) \{}
\DoxyCodeLine{214       status = WiFi.status();}
\DoxyCodeLine{215 }
\DoxyCodeLine{216       \textcolor{keywordflow}{if} (status == WL\_AP\_CONNECTED) \{}
\DoxyCodeLine{217         Serial.println(\textcolor{stringliteral}{"{}Device connected to AP"{}});}
\DoxyCodeLine{218         server.begin(); }
\DoxyCodeLine{219       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{220         Serial.println(\textcolor{stringliteral}{"{}Device disconnected from AP"{}});}
\DoxyCodeLine{221       \} }
\DoxyCodeLine{222     \}}
\DoxyCodeLine{223     app\_loop();}
\DoxyCodeLine{224     mdnsResponder.poll();}
\DoxyCodeLine{225 }
\DoxyCodeLine{226     WiFiClient client = server.available();   \textcolor{comment}{// listen for incoming clients}}
\DoxyCodeLine{227 }
\DoxyCodeLine{228     \textcolor{keywordflow}{if} (client) \{                             \textcolor{comment}{// if you get a client,}}
\DoxyCodeLine{229       String currentLine = \textcolor{stringliteral}{"{}"{}};                \textcolor{comment}{// make a String to hold incoming data from the client}}
\DoxyCodeLine{230       String config\_line = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{231       Request req = REQ\_ROOT;}
\DoxyCodeLine{232       \textcolor{keywordflow}{while} (client.connected()) \{            \textcolor{comment}{// loop while the client's connected}}
\DoxyCodeLine{233         \textcolor{keywordflow}{if} (client.available()) \{             \textcolor{comment}{// if there's bytes to read from the client,}}
\DoxyCodeLine{234           app\_loop();}
\DoxyCodeLine{235           \textcolor{keywordtype}{char} c = client.read();             \textcolor{comment}{// read a byte, then}}
\DoxyCodeLine{236           \textcolor{comment}{//Serial.write(c);                    // print it out the serial monitor}}
\DoxyCodeLine{237           \textcolor{keywordflow}{if} (c == \textcolor{charliteral}{'\(\backslash\)n'}) \{                    \textcolor{comment}{// if the byte is a newline character}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239             \textcolor{comment}{// if the current line is blank, you got two newline characters in a row.}}
\DoxyCodeLine{240             \textcolor{comment}{// that's the end of the client HTTP request, so send a response:}}
\DoxyCodeLine{241             \textcolor{keywordflow}{if} (currentLine.length() == 0) \{}
\DoxyCodeLine{242               String responce = \textcolor{stringliteral}{"{}200 OK"{}};}
\DoxyCodeLine{243               String content = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{244               String content\_type = \textcolor{stringliteral}{"{}text/html"{}};}
\DoxyCodeLine{245 }
\DoxyCodeLine{246   \textcolor{keywordflow}{switch}(req) \{}
\DoxyCodeLine{247   \textcolor{keywordflow}{case} REQ\_ROOT: \{}
\DoxyCodeLine{248     content = config\_form;}
\DoxyCodeLine{249   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{250   \textcolor{keywordflow}{case} REQ\_CONFIG: \{}
\DoxyCodeLine{251     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Applying configuration..."{}});}
\DoxyCodeLine{252     String ssid = urlFindArg(config\_line, \textcolor{stringliteral}{"{}ssid"{}});}
\DoxyCodeLine{253     String ssidManual = urlFindArg(config\_line, \textcolor{stringliteral}{"{}ssidManual"{}});}
\DoxyCodeLine{254     String pass = urlFindArg(config\_line, \textcolor{stringliteral}{"{}pass"{}});}
\DoxyCodeLine{255     \textcolor{keywordflow}{if} (ssidManual != \textcolor{stringliteral}{"{}"{}}) \{}
\DoxyCodeLine{256       ssid = ssidManual;}
\DoxyCodeLine{257     \}}
\DoxyCodeLine{258     String token = urlFindArg(config\_line, \textcolor{stringliteral}{"{}blynk"{}});}
\DoxyCodeLine{259     String host  = urlFindArg(config\_line, \textcolor{stringliteral}{"{}host"{}});}
\DoxyCodeLine{260     String port  = urlFindArg(config\_line, \textcolor{stringliteral}{"{}port\_ssl"{}});}
\DoxyCodeLine{261 }
\DoxyCodeLine{262     String ip   = urlFindArg(config\_line, \textcolor{stringliteral}{"{}ip"{}});}
\DoxyCodeLine{263     String mask = urlFindArg(config\_line, \textcolor{stringliteral}{"{}mask"{}});}
\DoxyCodeLine{264     String gw   = urlFindArg(config\_line, \textcolor{stringliteral}{"{}gw"{}});}
\DoxyCodeLine{265     String dns  = urlFindArg(config\_line, \textcolor{stringliteral}{"{}dns"{}});}
\DoxyCodeLine{266     String dns2 = urlFindArg(config\_line, \textcolor{stringliteral}{"{}dns2"{}});}
\DoxyCodeLine{267 }
\DoxyCodeLine{268     \textcolor{keywordtype}{bool} save  = urlFindArg(config\_line, \textcolor{stringliteral}{"{}save"{}}).toInt();}
\DoxyCodeLine{269 }
\DoxyCodeLine{270     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}WiFi SSID: "{}}) + ssid + \textcolor{stringliteral}{"{} Pass: "{}} + pass);}
\DoxyCodeLine{271     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Blynk cloud: "{}}) + token + \textcolor{stringliteral}{"{} @ "{}} + host + \textcolor{stringliteral}{"{}:"{}} + port);}
\DoxyCodeLine{272 }
\DoxyCodeLine{273     \textcolor{keywordflow}{if} (token.length() == 32 \&\& ssid.length() > 0) \{}
\DoxyCodeLine{274       configStore.setFlag(CONFIG\_FLAG\_VALID, \textcolor{keyword}{false});}
\DoxyCodeLine{275       CopyString(ssid, configStore.wifiSSID);}
\DoxyCodeLine{276       CopyString(pass, configStore.wifiPass);}
\DoxyCodeLine{277       CopyString(token, configStore.cloudToken);}
\DoxyCodeLine{278       \textcolor{keywordflow}{if} (host.length()) \{}
\DoxyCodeLine{279         CopyString(host,  configStore.cloudHost);}
\DoxyCodeLine{280       \}}
\DoxyCodeLine{281       \textcolor{keywordflow}{if} (port.length()) \{}
\DoxyCodeLine{282         configStore.cloudPort = port.toInt();}
\DoxyCodeLine{283       \}}
\DoxyCodeLine{284 }
\DoxyCodeLine{285       IPAddress addr;}
\DoxyCodeLine{286       }
\DoxyCodeLine{287       \textcolor{keywordflow}{if} (ip.length() \&\& addr.fromString(ip)) \{}
\DoxyCodeLine{288         configStore.staticIP = addr;}
\DoxyCodeLine{289         configStore.setFlag(CONFIG\_FLAG\_STATIC\_IP, \textcolor{keyword}{true});}
\DoxyCodeLine{290       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{291         configStore.setFlag(CONFIG\_FLAG\_STATIC\_IP, \textcolor{keyword}{false});}
\DoxyCodeLine{292       \}}
\DoxyCodeLine{293       \textcolor{keywordflow}{if} (mask.length() \&\& addr.fromString(mask)) \{}
\DoxyCodeLine{294         configStore.staticMask = addr;}
\DoxyCodeLine{295       \}}
\DoxyCodeLine{296       \textcolor{keywordflow}{if} (gw.length() \&\& addr.fromString(gw)) \{}
\DoxyCodeLine{297         configStore.staticGW = addr;}
\DoxyCodeLine{298       \}}
\DoxyCodeLine{299       \textcolor{keywordflow}{if} (dns.length() \&\& addr.fromString(dns)) \{}
\DoxyCodeLine{300         configStore.staticDNS = addr;}
\DoxyCodeLine{301       \}}
\DoxyCodeLine{302       \textcolor{keywordflow}{if} (dns2.length() \&\& addr.fromString(dns2)) \{}
\DoxyCodeLine{303         configStore.staticDNS2 = addr;}
\DoxyCodeLine{304       \}}
\DoxyCodeLine{305 }
\DoxyCodeLine{306       \textcolor{keywordflow}{if} (save) \{}
\DoxyCodeLine{307         configStore.setFlag(CONFIG\_FLAG\_VALID, \textcolor{keyword}{true});}
\DoxyCodeLine{308         config\_save();}
\DoxyCodeLine{309 }
\DoxyCodeLine{310         content = R\textcolor{stringliteral}{"{}json(\{"{}status"{}:"{}ok"{},"{}msg"{}:"{}Configuration saved"{}\})json"{};}}
\DoxyCodeLine{311 \textcolor{stringliteral}{      \} }\textcolor{keywordflow}{else} \{}
\DoxyCodeLine{312         content = R\textcolor{stringliteral}{"{}json(\{"{}status"{}:"{}ok"{},"{}msg"{}:"{}Trying to connect..."{}\})json"{};}}
\DoxyCodeLine{313 \textcolor{stringliteral}{      \}}}
\DoxyCodeLine{314 \textcolor{stringliteral}{}}
\DoxyCodeLine{315 \textcolor{stringliteral}{      BlynkState::set(MODE\_SWITCH\_TO\_STA);}}
\DoxyCodeLine{316 \textcolor{stringliteral}{    \} }\textcolor{keywordflow}{else} \{}
\DoxyCodeLine{317       \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Configuration invalid"{}});}
\DoxyCodeLine{318       content = R\textcolor{stringliteral}{"{}json(\{"{}status"{}:"{}error"{},"{}msg"{}:"{}Configuration invalid"{}\})json"{};}}
\DoxyCodeLine{319 \textcolor{stringliteral}{      responce = }\textcolor{stringliteral}{"{}500 Internal Error"{}};}
\DoxyCodeLine{320     \}}
\DoxyCodeLine{321     content\_type = \textcolor{stringliteral}{"{}application/json"{}};}
\DoxyCodeLine{322   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{323   \textcolor{keywordflow}{case} REQ\_BOARD\_INFO: \{}
\DoxyCodeLine{324     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Sending board info..."{}});}
\DoxyCodeLine{325     \textcolor{keyword}{const} \textcolor{keywordtype}{char}* tmpl = BLYNK\_TEMPLATE\_ID;}
\DoxyCodeLine{326     \textcolor{keywordtype}{char} ssidBuff[64];}
\DoxyCodeLine{327     getWiFiName(ssidBuff, \textcolor{keyword}{sizeof}(ssidBuff));}
\DoxyCodeLine{328     \textcolor{keywordtype}{char} buff[512];}
\DoxyCodeLine{329 }
\DoxyCodeLine{330     \textcolor{keywordtype}{byte} mac[6] = \{ 0, \};}
\DoxyCodeLine{331     WiFi.macAddress(mac);}
\DoxyCodeLine{332     }
\DoxyCodeLine{333     snprintf(buff, \textcolor{keyword}{sizeof}(buff),}
\DoxyCodeLine{334       R\textcolor{stringliteral}{"{}json(\{"{}board"{}:"{}\%s"{},"{}tmpl\_id"{}:"{}\%s"{},"{}fw\_type"{}:"{}\%s"{},"{}fw\_ver"{}:"{}\%s"{},"{}ssid"{}:"{}\%s"{},"{}bssid"{}:"{}\%02x:\%02x:\%02x:\%02x:\%02x:\%02x"{},"{}last\_error"{}:\%d,"{}wifi\_scan"{}:true,"{}static\_ip"{}:true\})json"{},}}
\DoxyCodeLine{335 \textcolor{stringliteral}{      BLYNK\_DEVICE\_NAME,}}
\DoxyCodeLine{336 \textcolor{stringliteral}{      tmpl ? tmpl : }\textcolor{stringliteral}{"{}Unknown"{}},}
\DoxyCodeLine{337       BLYNK\_FIRMWARE\_TYPE,}
\DoxyCodeLine{338       BLYNK\_FIRMWARE\_VERSION,}
\DoxyCodeLine{339       ssidBuff,}
\DoxyCodeLine{340       mac[5], mac[4], mac[3], mac[2], mac[1], mac[0],}
\DoxyCodeLine{341       configStore.last\_error}
\DoxyCodeLine{342     );}
\DoxyCodeLine{343     content = buff;}
\DoxyCodeLine{344     content\_type = \textcolor{stringliteral}{"{}application/json"{}};}
\DoxyCodeLine{345   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{346   \textcolor{keywordflow}{case} REQ\_SCAN\_WIFI: \{}
\DoxyCodeLine{347     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Sending networks..."{}});}
\DoxyCodeLine{348     content = networks;}
\DoxyCodeLine{349     content\_type = \textcolor{stringliteral}{"{}application/json"{}};}
\DoxyCodeLine{350   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{351   \textcolor{keywordflow}{case} REQ\_RESET: \{}
\DoxyCodeLine{352     BlynkState::set(MODE\_RESET\_CONFIG);}
\DoxyCodeLine{353     content = R\textcolor{stringliteral}{"{}json(\{"{}status"{}:"{}ok"{},"{}msg"{}:"{}Configuration reset"{}\})json"{};}}
\DoxyCodeLine{354 \textcolor{stringliteral}{    content\_type = }\textcolor{stringliteral}{"{}application/json"{}};}
\DoxyCodeLine{355   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{356   \textcolor{keywordflow}{case} REQ\_REBOOT: \{}
\DoxyCodeLine{357     restartMCU();}
\DoxyCodeLine{358   \} \textcolor{keywordflow}{break};}
\DoxyCodeLine{359   \}}
\DoxyCodeLine{360 }
\DoxyCodeLine{361               client.println(\textcolor{stringliteral}{"{}HTTP/1.1 "{}} + responce);}
\DoxyCodeLine{362               client.println(\textcolor{stringliteral}{"{}Content-\/type:"{}} + content\_type);}
\DoxyCodeLine{363               client.println();}
\DoxyCodeLine{364               client.println(content);}
\DoxyCodeLine{365               \textcolor{comment}{// break out of the while loop:}}
\DoxyCodeLine{366               \textcolor{keywordflow}{break};}
\DoxyCodeLine{367             \} \textcolor{keywordflow}{else} \{      \textcolor{comment}{// if you got a newline, then clear currentLine:}}
\DoxyCodeLine{368               currentLine = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{369             \}}
\DoxyCodeLine{370           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (c != \textcolor{charliteral}{'\(\backslash\)r'}) \{  \textcolor{comment}{// if you got anything else but a carriage return character,}}
\DoxyCodeLine{371             currentLine += c;      \textcolor{comment}{// add it to the end of the currentLine}}
\DoxyCodeLine{372           \}}
\DoxyCodeLine{373   }
\DoxyCodeLine{374           \textcolor{keywordflow}{if} (currentLine.indexOf(\textcolor{stringliteral}{"{}GET /board\_info.json"{}}) >= 0) \{}
\DoxyCodeLine{375             req = REQ\_BOARD\_INFO;}
\DoxyCodeLine{376           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentLine.indexOf(\textcolor{stringliteral}{"{}GET /wifi\_scan.json"{}}) >= 0) \{}
\DoxyCodeLine{377             req = REQ\_SCAN\_WIFI;}
\DoxyCodeLine{378           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentLine.indexOf(\textcolor{stringliteral}{"{} /config"{}}) >= 0) \{}
\DoxyCodeLine{379             req = REQ\_CONFIG;}
\DoxyCodeLine{380             \textcolor{keywordtype}{int} idx = currentLine.indexOf(\textcolor{stringliteral}{"{}?"{}});}
\DoxyCodeLine{381             config\_line = \textcolor{stringliteral}{"{}\&"{}} + currentLine.substring(idx+1, currentLine.lastIndexOf(\textcolor{charliteral}{' '})) + \textcolor{stringliteral}{"{}\&"{}};}
\DoxyCodeLine{382           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentLine.indexOf(\textcolor{stringliteral}{"{} /reset"{}}) >= 0) \{}
\DoxyCodeLine{383             req = REQ\_RESET;}
\DoxyCodeLine{384           \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (currentLine.indexOf(\textcolor{stringliteral}{"{} /reboot"{}}) >= 0) \{}
\DoxyCodeLine{385             req = REQ\_REBOOT;}
\DoxyCodeLine{386           \}}
\DoxyCodeLine{387         \}}
\DoxyCodeLine{388       \}}
\DoxyCodeLine{389       client.stop();}
\DoxyCodeLine{390     \}}
\DoxyCodeLine{391   \}}
\DoxyCodeLine{392 \}}
\DoxyCodeLine{393 }
\DoxyCodeLine{394 \textcolor{keywordtype}{void} enterConnectNet() \{}
\DoxyCodeLine{395   BlynkState::set(MODE\_CONNECTING\_NET);}
\DoxyCodeLine{396   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(String(\textcolor{stringliteral}{"{}Connecting to WiFi: "{}}) + configStore.wifiSSID);}
\DoxyCodeLine{397 }
\DoxyCodeLine{398   \textcolor{comment}{// This is needed, otherwise WiFi.hostname() hangs}}
\DoxyCodeLine{399   WiFi.end();}
\DoxyCodeLine{400   delay(100);}
\DoxyCodeLine{401   WiFi.begin();}
\DoxyCodeLine{402 }
\DoxyCodeLine{403   \textcolor{keywordtype}{char} ssidBuff[64];}
\DoxyCodeLine{404   getWiFiName(ssidBuff, \textcolor{keyword}{sizeof}(ssidBuff));}
\DoxyCodeLine{405   String hostname(ssidBuff);}
\DoxyCodeLine{406   hostname.replace(\textcolor{stringliteral}{"{} "{}}, \textcolor{stringliteral}{"{}-\/"{}});}
\DoxyCodeLine{407   WiFi.hostname(hostname.c\_str());}
\DoxyCodeLine{408 }
\DoxyCodeLine{409   \textcolor{keywordflow}{if} (configStore.getFlag(CONFIG\_FLAG\_STATIC\_IP)) \{}
\DoxyCodeLine{410         WiFi.config(configStore.staticIP,}
\DoxyCodeLine{411                     configStore.staticDNS,}
\DoxyCodeLine{412                     configStore.staticGW,}
\DoxyCodeLine{413                     configStore.staticMask);}
\DoxyCodeLine{414   \}}
\DoxyCodeLine{415 }
\DoxyCodeLine{416   WiFi.begin(configStore.wifiSSID, configStore.wifiPass);}
\DoxyCodeLine{417 }
\DoxyCodeLine{418   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeoutMs = millis() + WIFI\_NET\_CONNECT\_TIMEOUT;}
\DoxyCodeLine{419   \textcolor{keywordflow}{while} ((timeoutMs > millis()) \&\& (WiFi.status() != WL\_CONNECTED))}
\DoxyCodeLine{420   \{}
\DoxyCodeLine{421     delay(10);}
\DoxyCodeLine{422     app\_loop();}
\DoxyCodeLine{423 }
\DoxyCodeLine{424     \textcolor{keywordflow}{if} (!BlynkState::is(MODE\_CONNECTING\_NET)) \{}
\DoxyCodeLine{425       WiFi.disconnect();}
\DoxyCodeLine{426       \textcolor{keywordflow}{return};}
\DoxyCodeLine{427     \}}
\DoxyCodeLine{428   \}}
\DoxyCodeLine{429 }
\DoxyCodeLine{430   \textcolor{keywordflow}{if} (WiFi.status() == WL\_CONNECTED) \{}
\DoxyCodeLine{431     IPAddress localip = WiFi.localIP();}
\DoxyCodeLine{432     \textcolor{keywordflow}{if} (configStore.getFlag(CONFIG\_FLAG\_STATIC\_IP)) \{}
\DoxyCodeLine{433       BLYNK\_LOG\_IP(\textcolor{stringliteral}{"{}Using Static IP: "{}}, localip);}
\DoxyCodeLine{434     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{435       BLYNK\_LOG\_IP(\textcolor{stringliteral}{"{}Using Dynamic IP: "{}}, localip);}
\DoxyCodeLine{436     \}}
\DoxyCodeLine{437 }
\DoxyCodeLine{438     BlynkState::set(MODE\_CONNECTING\_CLOUD);}
\DoxyCodeLine{439   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{440     config\_set\_last\_error(BLYNK\_PROV\_ERR\_NETWORK);}
\DoxyCodeLine{441     BlynkState::set(MODE\_ERROR);}
\DoxyCodeLine{442   \}}
\DoxyCodeLine{443 \}}
\DoxyCodeLine{444 }
\DoxyCodeLine{445 \textcolor{keywordtype}{void} enterConnectCloud() \{}
\DoxyCodeLine{446   BlynkState::set(MODE\_CONNECTING\_CLOUD);}
\DoxyCodeLine{447 }
\DoxyCodeLine{448   Blynk.config(configStore.cloudToken, configStore.cloudHost, configStore.cloudPort);}
\DoxyCodeLine{449   Blynk.connect(0);}
\DoxyCodeLine{450 }
\DoxyCodeLine{451   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeoutMs = millis() + WIFI\_CLOUD\_CONNECT\_TIMEOUT;}
\DoxyCodeLine{452   \textcolor{keywordflow}{while} ((timeoutMs > millis()) \&\&}
\DoxyCodeLine{453         (!Blynk.isTokenInvalid()) \&\&}
\DoxyCodeLine{454         (Blynk.connected() == \textcolor{keyword}{false}))}
\DoxyCodeLine{455   \{}
\DoxyCodeLine{456     delay(10);}
\DoxyCodeLine{457     Blynk.run();}
\DoxyCodeLine{458     app\_loop();}
\DoxyCodeLine{459     \textcolor{keywordflow}{if} (!BlynkState::is(MODE\_CONNECTING\_CLOUD)) \{}
\DoxyCodeLine{460       Blynk.disconnect();}
\DoxyCodeLine{461       \textcolor{keywordflow}{return};}
\DoxyCodeLine{462     \}}
\DoxyCodeLine{463   \}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465   \textcolor{keywordflow}{if} (millis() > timeoutMs) \{}
\DoxyCodeLine{466     \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Timeout"{}});}
\DoxyCodeLine{467   \}}
\DoxyCodeLine{468 }
\DoxyCodeLine{469   \textcolor{keywordflow}{if} (Blynk.isTokenInvalid()) \{}
\DoxyCodeLine{470     config\_set\_last\_error(BLYNK\_PROV\_ERR\_TOKEN);}
\DoxyCodeLine{471     BlynkState::set(MODE\_WAIT\_CONFIG);}
\DoxyCodeLine{472   \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Blynk.connected()) \{}
\DoxyCodeLine{473     BlynkState::set(MODE\_RUNNING);}
\DoxyCodeLine{474 }
\DoxyCodeLine{475     \textcolor{keywordflow}{if} (!configStore.getFlag(CONFIG\_FLAG\_VALID)) \{}
\DoxyCodeLine{476       configStore.last\_error = BLYNK\_PROV\_ERR\_NONE;}
\DoxyCodeLine{477       configStore.setFlag(CONFIG\_FLAG\_VALID, \textcolor{keyword}{true});}
\DoxyCodeLine{478       config\_save();}
\DoxyCodeLine{479     \}}
\DoxyCodeLine{480   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{481     config\_set\_last\_error(BLYNK\_PROV\_ERR\_CLOUD);}
\DoxyCodeLine{482     BlynkState::set(MODE\_ERROR);}
\DoxyCodeLine{483   \}}
\DoxyCodeLine{484 \}}
\DoxyCodeLine{485 }
\DoxyCodeLine{486 \textcolor{keywordtype}{void} enterSwitchToSTA() \{}
\DoxyCodeLine{487   BlynkState::set(MODE\_SWITCH\_TO\_STA);}
\DoxyCodeLine{488 }
\DoxyCodeLine{489   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Switching to STA..."{}});}
\DoxyCodeLine{490 }
\DoxyCodeLine{491   delay(1000);}
\DoxyCodeLine{492 }
\DoxyCodeLine{493   BlynkState::set(MODE\_CONNECTING\_NET);}
\DoxyCodeLine{494 \}}
\DoxyCodeLine{495 }
\DoxyCodeLine{496 \textcolor{keywordtype}{void} enterError() \{}
\DoxyCodeLine{497   BlynkState::set(MODE\_ERROR);}
\DoxyCodeLine{498   }
\DoxyCodeLine{499   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} timeoutMs = millis() + 10000;}
\DoxyCodeLine{500   \textcolor{keywordflow}{while} (timeoutMs > millis() || g\_buttonPressed)}
\DoxyCodeLine{501   \{}
\DoxyCodeLine{502     delay(10);}
\DoxyCodeLine{503     app\_loop();}
\DoxyCodeLine{504     \textcolor{keywordflow}{if} (!BlynkState::is(MODE\_ERROR)) \{}
\DoxyCodeLine{505       \textcolor{keywordflow}{return};}
\DoxyCodeLine{506     \}}
\DoxyCodeLine{507   \}}
\DoxyCodeLine{508   \mbox{\hyperlink{_d_h_t_8h_a88edd2aa4feabff4af21a997d5d8aa23}{DEBUG\_PRINT}}(\textcolor{stringliteral}{"{}Restarting after error."{}});}
\DoxyCodeLine{509   delay(10);}
\DoxyCodeLine{510 }
\DoxyCodeLine{511   restartMCU();}
\DoxyCodeLine{512 \}}
\DoxyCodeLine{513 }

\end{DoxyCode}
